# 🚀 Atlas ORM 效能測試報告

> **測試日期：** 2025 年 12 月 24 日
> **測試環境：** Docker (Linux arm64), Bun Runtime v1.x
> **測試重點：** 跨資料庫效能與記憶體穩定性

本報告提供了 `@gravito/atlas` 在所有支援的資料庫引擎上的綜合效能比較。

## 📊 效能摘要 (每秒操作次數 / OPS)

| 指標 | SQLite (記憶體) | PostgreSQL | MySQL 8.0 | MariaDB |
| :--- | :--- | :--- | :--- | :--- |
| **原始讀取 (基準線)** | **~3,523,000** | **~1,110,000** | **~521,000** | **~1,111,000** |
| **模型水合 (Hydration)** | **~223,000** | **~193,000** | **~240,000** | **~253,000** |
| **批次寫入 (Bulk Insert)** | **~415,000** | **~44,000** | **~26,000** | **~49,000** |
| **串流 (Cursor)** | **~197,000** | **~129,000** | **~132,000** | **~135,000** |

---

## 1. ⚡ 吞吐量分析

### **「Active Record」的極致效率**
Atlas 達到了菁英級別的水合速度，在不同驅動程式間平均達到 **每秒超過 200,000 個模型**。
*   **結果：** 抽象化成本被最小化。您在獲得完整 ORM 優勢（髒檢查、事件、關聯）的同時，效能仍可媲美原始查詢建構器。
*   **PostgreSQL 的卓越表現：** 原始讀取 IOPS 超過 100 萬，展現了我們非阻塞非同步核心的效率。

---

## 2. 🧠 記憶體穩定性 (無限串流)

我們透過每個驅動程式處理 50,000 筆紀錄（約 50MB 負載）來驗證 `Model.cursor()` API。

| 驅動程式 | 堆疊 (Heap) 變化 | 狀態 |
| :--- | :--- | :--- |
| **SQLite** | +19.27 MB | ✅ 穩定 |
| **PostgreSQL** | -8.55 MB* | ✅ 已回收 |
| **MySQL** | +2.62 MB | ✅ 穩定 |
| **MariaDB** | +19.87 MB | ✅ 穩定 |

*\*負值表示在串流過程中進行了積極的 GC 回收，證明已處理的物件零殘留。*

---

## 🛡️ 安全性與可靠性驗證

除了效能之外，基準測試套件還成功驗證了：
*   ✅ **自動參數化：** 在高吞吐量壓力測試下未檢測到 SQL 注入向量。
*   ✅ **標準化異常：** 特定於資料庫的錯誤被正確標準化為 `UniqueConstraintError` 等。
*   ✅ **統一架構建構器：** 相同的遷移語法在 4 種不同的 SQL 方言中皆能正常運作。

---

## 🏗️ 重現測試

在您的本機上執行完整的自動化測試套件：

```bash
git clone https://github.com/gravito-framework/gravito.git
cd examples/atlas-benchmark
docker-compose up --build
```
